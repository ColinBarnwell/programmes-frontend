{%- set broadcast_classes = build_css_classes({
    'broadcast': true,
    'broadcast--has-ended': broadcast.isInThePast,
    'block-link block-link--steal': broadcast.option('steal_blocklink'),
    (broadcast.option('container_classes')): broadcast.option('container_classes'),
    (broadcast.option('highlight_box_classes')): broadcast.option('highlight_box_classes'),
    'br-keyline br-blocklink-page br-page-linkhover-onbg015--hover': broadcast.option('highlight_box_classes'),
    'br-box-subtle highlight-box--active': broadcast.option('steal_blocklink') and broadcast.isOnAirNow,
}) -%}

{%- set info_classes = build_css_classes({
    '1/4 1/6@bpb2 1/6@bpw': not broadcast.option('is_stacked'),
}) -%}

{%- set programme_classes = build_css_classes({
    '3/4 5/6@bpb2 5/6@bpw': not broadcast.option('is_stacked'),
}) -%}

<div class="{{ broadcast_classes }}" vocab="http://schema.org/" typeof="BroadcastEvent">
    <div class="grid-wrapper">
        <div class="broadcast__info grid {{ info_classes }}">
            {#start time and zone#}
            <h3 class="broadcast__time gamma" data-timezone="true" property="startDate" datatype="xsd:dateTime" content="{{ broadcast.startAt|date('c') }}">
                <span class="timezone--time">{{ broadcast.startAt|local_date('H:i') }}{{ broadcast.startAt|time_zone_note() }}</span>
                {%- if broadcast.option('show_date') -%}
                    <br /><span class="micro timezone--date">{{ broadcast.startAt|local_date('d/m/Y') }}</span>
                {%- endif -%}
            </h3>

            {#end time and zone#}
            <meta property="endDate" datatype="xsd:dateTime" content="{{ broadcast.endAt|date('c')}}" />
            <span property="publishedOn" typeof="BroadcastService" resource="{{ path('schedules_by_day', {'pid' : broadcast.servicePid }) }}">
                <meta property="name" content="{{ broadcast.serviceName }}" />
            </span>

            {%- if not broadcast.programmeItem -%}
                <div class="broadcast__live centi br-box-subtle">
                    {{- tr('off_air') -}}
                </div>
            {%- elseif broadcast.isOnAirNow -%}
                <div class="broadcast__live centi br-box-highlight">
                    {{- tr(broadcast.onAirMessage) -}}
                </div>
            {%- endif -%}
        </div>
        <div class="broadcast__programme grid {{ programme_classes }}" rev="publication">
            {%- if broadcast.programmeItem -%}
                {#- This currently only implements the subset of functionality needed for the broadcast-by-day page.
                   Other options on this page may need changes here -#}
                {%- set programme_options = {
                    'highlight_box_classes': '',
                    'context_service': broadcast.broadcast.service,
                    'image_options': {
                        'classes': '1/4@bpb1 1/4@bpb2 1/4@bpw hidden visible@bpb2 visible@bpw',
                        'default_width': 160,
                        'is_lazy_loaded': true,
                        'sizes': {
                            0: '0vw',
                            480: '18.6vw',
                            800: '148px',
                        }
                    },
                } -%}
                {%- if broadcast.collapsedBroadcast -%}
                    {# Only show collapsed brocast presenter when we have it #}
                    {{ ds2013('collapsedBroadcastProgramme', broadcast.collapsedBroadcast, broadcast.programmeItem, programme_options) }}
                {%- else -%}
                    {{ ds2013('programme', broadcast.programmeItem, programme_options) }}
                {%- endif -%}
            {%- else -%}
                <p class="text--subtle centi" data-timezone="true" content="{{ broadcast.endAt|date('c') }}">
                    {{- tr('programmes_resume_at', {'%1': '<span class="timezone--time">' ~ broadcast.endAt|local_date('H:i') ~ '</span>'})|raw -}}
                </p>
            {%- endif -%}
        </div>
    </div>
</div>

