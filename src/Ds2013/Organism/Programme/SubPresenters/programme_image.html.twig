{% if programme_image.option('show_image') or programme_image.option('show_overlay') %}
    {% set outer_div_classes = build_css_classes({
        'programme__img' : true,
        (programme_image.option('classes')): true,
        'programme__img--available' : programme_image.isAvailable,
        'programme__img--hasimage' : true,
    }) %}

    <div class="{{ outer_div_classes }}">
        {% if programme_image.option('show_image') %}
            <meta property="image" content="{{ programme_image.getImageUrl(480,270)}}" />
            {{ ds2013('image', programme_image.image, programme_image.option('sizes'), {
                'is_lazy_loaded' : programme_image.option('is_lazy_loaded')
            })}}
        {% endif %}

        {% block overlay %}
            {# This block is overriden (and called directly) from BroadcastProgrammeImagePresenter #}
            {% if programme_image.option('show_overlay') %}
                {% set overlay_container_classes = build_css_classes({
                    'programme__overlay' : true,
                    'programme__overlay--available' : programme_image.isAvailable,
                }) %}

                <div class="{{ overlay_container_classes }}">
                    {% if not programme_image.isContainer and  programme_image.isAvailable %}
                        {% set programme_icon_classes = build_css_classes({
                            'programme__icon' : true,
                            ('br-box-' ~ programme_image.option('branding_context')): true,
                            'iplayer-icon iplayer-icon--boxed': programme_image.isEpisode,
                        }) %}
                        {% if programme_image.isEpisode %}
                            <div property="{{ rdfa_schema_media_type(programme_image.programme) }}" typeof="{{ rdfa_schema_mediaobject_typeof(programme_image.programme) }}">
                                <a property="url"
                                   resource="http://www.bbc.co.uk{{ programme_image.playbackUrl }}"
                                   href="{{ programme_image.playbackUrl }}"
                                   class="programme__availability programme__player iplayer-icon--container"
                                   title="{{ programme_image.availabilityInWords }}"
                                   data-linktrack="programmeobjectlink=cta"
                                >
                                    <div class="{{ programme_icon_classes }}">
                                        {{ gelicon('audio-visual', programme_image.mediaIconName, 20) }}
                                    </div>
                                    <meta property="description" content="{{ programme_image.programme.shortSynopsis }}" />
                                    <meta property="thumbnailUrl" content="{{ programme_image.getImageUrl(1920, 1080) }}" />
                                    {% if programme_image.programme.streamableFrom %}
                                        <meta property="uploadDate" content="{{ programme_image.programme.streamableFrom.format(constant('DateTime::ATOM')) }}" />
                                    {% endif %}
                                    <meta property="name" content="{{ programme_image.programme.title }}" />
                                </a>
                            </div>
                            {% if programme_image.programme.streamableUntil %}
                                <span property="publication" typeof="OnDemandEvent">
                                    <meta property="endDate" datatype="xsd:dateTime" content="{{ programme_image.programme.streamableUntil.format(constant('DateTime::ATOM')) }}" />
                                </span>
                            {% endif %}
                        {% else %}
                            {# If our available programme is NOT an episode, e.g. a clip #}
                            <div class="{{ programme_icon_classes }}">
                                {{ gelicon('audio-visual', programme_image.mediaIconName, 20) }}
                            </div>
                            <meta property="description" content="{{ programme_image.programme.shortSynopsis }}" />
                            <meta property="thumbnailUrl" content="{{ programme_image.getImageUrl(1920, 1080) }}" />
                        {% endif %}
                    {% endif %}
                </div>
            {% endif %}
        {% endblock %}

    </div>
{% endif %}
