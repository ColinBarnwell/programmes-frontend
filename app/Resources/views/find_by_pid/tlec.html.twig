{% extends 'base_ds_amen.html.twig' %}

{% block html_classes %}b-pw-1280{% endblock %}
{% block page_classes %}gel-long-primer amen{% endblock %}
{% block title %}{{ meta_context.titlePrefix() }}{% endblock %}
{% block adsToDisplay %}leaderboard mpu{% endblock %}

{% block body %}
    {# TODO Leaderboard Advert #}
    <div class="p-g-p">
        {{ advert('leaderboard', [1,2,3,4]) }}
    </div>

    {# TODO BBC Live Promo #}

    {% if isVotePriority %}
        <div class="p-g-p">
            <div class="grid leading-gap">
                <div class="grid__item">
                    {{ dump(programme.getOption('brand_layout'), programme.getOption('ivote_block')) }}
                </div>
            </div>
        </div>
    {% endif %}

    {% if mapPresenter.showMap() %}
        {{ ds_amen_presenter(mapPresenter) }}
    {% endif %}

    <div class="p-g-p">
        <div class="leading-gap cf">
            {#{%- if programme.getOption('prioritytext_block') or isbbcdotcom or hasrecipes -%} TODO #}
            {%- if programme.getOption('prioritytext_block') -%}
                <div class="grid">
                    {%- if programme.getOption('prioritytext_block') -%}
                        <div class="grid__item 1/1">
                            <div class="br-box-secondary island">
                                {%- if programme.getOption('prioritytext_block').content.title -%}
                                    <h2 class="map__heading gel-great-primer-bold">{{ programme.getOption('prioritytext_block').content.title }}</h2>
                                {%- endif -%}
                                <p>{{ programme.getOption('prioritytext_block').content.text }}</p>
                            </div>
                        </div>
                    {%- endif -%}

                    {# TODO MPU Advert #}

                    {# TODO Recipes block #}
                </div>
            {%- endif -%}

            {# TODO Promos / Galleries list #}
            {%- if promotions or clips or galleries -%}
                <ul class="grid">
                    {%- for promotion in promotions -%}
                        {# @TODO should this be moved out into a page presenter or something. It's fugly #}
                        {%- if loop.first and programme.getOption('double_width_first_promo') -%}
                            {%- set promo_widths = '2/3@gel3b 1/2@gel5' -%}
                            {%- set img_sizes = { 600 : 1/1, 768 : 2/3, 1008 : '645px', 1280 : '600px'} -%}
                            {%- set img_default_width = 640 -%}
                        {%- else -%}
                            {%- set promo_widths = '1/2@gel3 1/3@gel3b 1/4@gel5' -%}
                            {%- set img_sizes = { 600 : 1/2, 768 : 1/3, 1008 : '315px', 1280 : '300px'} -%}
                            {%- set img_default_width = 320 -%}
                        {%- endif -%}
                        <li class="grid__item {{ promo_widths }}">
                            {{- ds_amen('promotion', promotion, {
                                'related_links_count': 2,
                                'img_sizes': img_sizes,
                                'img_default_width': img_default_width,
                                'img_is_lazy_loaded': false,
                                'media_variant': 'media--column media--card',
                                'cta_class': 'br-box-secondary',
                                'branding_name': 'secondary',
                                'link_location_prefix': 'promo_' ~ loop.index ~ '_',
                                'show_synopsis': false,
                            }) -}}
                        </li>
                    {%- endfor -%}

                    {%- for clip in clips -%}
                        <li class="grid__item 1/2@gel3 1/3@gel3b 1/4@gel5">
                            {{ ds_amen('programme', clip, {
                                'context_programme': programme,
                                'branding_name': 'secondary',
                                'title_options': {
                                    'text_colour_on_title_link': true,
                                    'title_size_small': 'gel-long-primer',
                                },
                                'image_options': {
                                    'sizes': {
                                        600 : 1/2,
                                        768 : 1/3,
                                        1008 : '315px',
                                        1280 : '300px',
                                    },
                                },
                                'cta_options': {
                                    'cta_class': 'br-box-secondary',
                                }
                            })}}

                            {%- if loop.last and programme.getAvailableClipsCount() > 4 -%}
                                <div class="br-box-secondary">
                                    <div class="media__footer br-keyline">
                                        <a href="{{ path('programme_clips', { pid: programme.getPid() }) }}" class="icon-link link-complex 1/1 gel-pica-bold">
                                            {{ gelicon('media', 'collection', 'gelicon--programme br-secondary-text-ontext') }}
                                            <span class="link-complex__target icon-label">{{ tr('see_all_clips') }}</span>
                                        </a>
                                    </div>
                                </div>
                            {%- endif -%}
                        </li>
                    {%- endfor -%}
                {%- endif -%}
            </ul>
            {# TODO Supporting Content blocks #}

            {# TODO Regular Vote block #}
        </div>
    </div>

    {# TODO Related links block #}

    {{ ds_amen('footer', programme) }}
{% endblock %}
